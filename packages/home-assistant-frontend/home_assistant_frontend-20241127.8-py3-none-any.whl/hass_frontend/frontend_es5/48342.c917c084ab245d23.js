"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["48342"],{96e3:function(e,t,r){var i,n,a,o,s=r(9833),l=r(94524),d=r(63038),u=r(27862),h=r(52565),c=r(92776),p=r(5776),y=r(21475),f=r(77204),v=(r(92894),r(38419),r(19083),r(71695),r(42713),r(40251),r(19134),r(11740),r(61006),r(99341),r(47021),r(72700),r(8038),r(71513),r(75656),r(50100),r(18084),r(57243)),k=r(50778),_=r(36522),m=r(76320),E=(r(99426),r(47844)),b=r(72344);(0,y.Z)([(0,k.Mo)("ha-hls-player")],(function(e,t){var y,x,w,g,S,L=function(t){function r(){var t;(0,h.Z)(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return t=(0,c.Z)(this,r,[].concat(n)),e(t),t}return(0,p.Z)(r,t),(0,u.Z)(r)}(t);return{F:L,d:[{kind:"field",decorators:[(0,k.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,k.Cb)()],key:"entityid",value:void 0},{kind:"field",decorators:[(0,k.Cb)()],key:"url",value:void 0},{kind:"field",decorators:[(0,k.Cb)({attribute:"poster-url"})],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,k.IO)("video")],key:"_videoEl",value:void 0},{kind:"field",decorators:[(0,k.SB)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,k.SB)()],key:"_errorIsFatal",value:function(){return!1}},{kind:"field",decorators:[(0,k.SB)()],key:"_url",value:void 0},{kind:"field",key:"_hlsPolyfillInstance",value:void 0},{kind:"field",key:"_exoPlayer",value:function(){return!1}},{kind:"field",static:!0,key:"streamCount",value:function(){return 0}},{kind:"method",key:"connectedCallback",value:function(){(0,f.Z)(L,"connectedCallback",this,3)([]),L.streamCount+=1,this.hasUpdated&&(this._resetError(),this._startHls())}},{kind:"method",key:"disconnectedCallback",value:function(){(0,f.Z)(L,"disconnectedCallback",this,3)([]),L.streamCount-=1,this._cleanUp()}},{kind:"method",key:"render",value:function(){return(0,v.dy)(i||(i=(0,d.Z)([" "," "," "])),this._error?(0,v.dy)(n||(n=(0,d.Z)(['<ha-alert alert-type="error" class="','"> '," </ha-alert>"])),this._errorIsFatal?"fatal":"retry",this._error):"",this._errorIsFatal?"":(0,v.dy)(a||(a=(0,d.Z)(['<video .poster="','" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" @loadeddata="','"></video>'])),this.posterUrl,this.autoPlay,this.muted,this.playsInline,this.controls,this._loadedData))}},{kind:"method",key:"updated",value:function(e){(0,f.Z)(L,"updated",this,3)([e]);var t=e.has("entityid"),r=e.has("url");t?this._getStreamUrlFromEntityId():r&&this.url&&(this._cleanUp(),this._resetError(),this._url=this.url,this._startHls())}},{kind:"method",key:"_getStreamUrlFromEntityId",value:(S=(0,l.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cleanUp(),this._resetError(),(0,b.p)(this.hass,"stream")){e.next=5;break}return this._setFatalError("Streaming component is not loaded."),e.abrupt("return");case 5:if(this.entityid){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,(0,E.Lr)(this.hass,this.entityid);case 10:t=e.sent,r=t.url,this._url=r,this._cleanUp(),this._resetError(),this._startHls(),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error(e.t0),(0,_.B)(this,"streams",{hasAudio:!1,hasVideo:!1});case 22:case"end":return e.stop()}}),e,this,[[7,18]])}))),function(){return S.apply(this,arguments)})},{kind:"method",key:"_startHls",value:(g=(0,l.Z)((0,s.Z)().mark((function e(){var t,i,n,a,o,l,d,u,h,c,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=fetch(this._url),e.next=3,Promise.all([r.e("68182"),r.e("66095")]).then(r.bind(r,17231));case 3:if(n=e.sent.default,this.isConnected){e.next=6;break}return e.abrupt("return");case 6:if((a=n.isSupported())||(a=""!==this._videoEl.canPlayType("application/vnd.apple.mpegurl")),a){e.next=11;break}return this._setFatalError(this.hass.localize("ui.components.media-browser.video_not_supported")),e.abrupt("return");case 11:return o=this.allowExoPlayer&&(null===(t=this.hass.auth.external)||void 0===t?void 0:t.config.hasExoPlayer),e.next=14,i;case 14:return e.next=16,e.sent.text();case 16:if(l=e.sent,this.isConnected){e.next=19;break}return e.abrupt("return");case 19:u=(d=/#EXT-X-STREAM-INF:.*?(?:CODECS=".*?([^.]*)?\..*?,([^.]*)?\..*?".*?)?(?:\n|\r\n)(.+)/g).exec(l),h=d.exec(l),c=null!==u&&null===h?new URL(u[3],this._url).href:this._url,p=u?"".concat(u[1],",").concat(u[2]):void 0,this._reportStreams(p),o&&(null!=p&&p.includes("hevc")||null!=p&&p.includes("hev1"))?this._renderHLSExoPlayer(c):n.isSupported()?this._renderHLSPolyfill(this._videoEl,n,c):this._renderHLSNative(this._videoEl,c);case 26:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{kind:"method",key:"_renderHLSExoPlayer",value:(w=(0,l.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._exoPlayer=!0,window.addEventListener("resize",this._resizeExoPlayer),this.updateComplete.then((function(){return(0,m.y)()})).then(this._resizeExoPlayer),this._videoEl.style.visibility="hidden",e.next=6,this.hass.auth.external.fireMessage({type:"exoplayer/play_hls",payload:{url:new URL(t,window.location.href).toString(),muted:this.muted}});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{kind:"field",key:"_resizeExoPlayer",value:function(){var e=this;return function(){if(e._videoEl){var t=e._videoEl.getBoundingClientRect();e.hass.auth.external.fireMessage({type:"exoplayer/resize",payload:{left:t.left,top:t.top,right:t.right,bottom:t.bottom}})}}}},{kind:"method",key:"_isLLHLSSupported",value:function(){if(L.streamCount<=2)return!0;if(!("performance"in window)||0===performance.getEntriesByType("resource").length)return!1;var e=performance.getEntriesByType("resource")[0];return"nextHopProtocol"in e&&"h2"===e.nextHopProtocol}},{kind:"method",key:"_renderHLSPolyfill",value:(x=(0,l.Z)((0,s.Z)().mark((function e(t,r,i){var n,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new r({backBufferLength:60,fragLoadingTimeOut:3e4,manifestLoadingTimeOut:3e4,levelLoadingTimeOut:3e4,maxLiveSyncPlaybackRate:2,lowLatencyMode:this._isLLHLSSupported()}),this._hlsPolyfillInstance=n,n.attachMedia(t),n.on(r.Events.MEDIA_ATTACHED,(function(){a._resetError(),n.loadSource(i)})),n.on(r.Events.FRAG_LOADED,(function(e,t){a._resetError()})),n.on(r.Events.ERROR,(function(e,t){if(t.fatal)if(t.type===r.ErrorTypes.NETWORK_ERROR){switch(t.details){case r.ErrorDetails.MANIFEST_LOAD_ERROR:var i="Error starting stream, see logs for details";void 0!==t.response&&void 0!==t.response.code&&(t.response.code>=500?i+=" (Server failure)":t.response.code>=400?i+=" (Stream never started)":i+=" ("+t.response.code+")"),a._setRetryableError(i);break;case r.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a._setRetryableError("Timeout while starting stream");break;default:a._setRetryableError("Stream network error")}n.startLoad()}else t.type===r.ErrorTypes.MEDIA_ERROR?(a._setRetryableError("Error with media stream contents"),n.recoverMediaError()):a._setFatalError("Error playing stream")}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return x.apply(this,arguments)})},{kind:"method",key:"_renderHLSNative",value:(y=(0,l.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.src=r,t.addEventListener("loadedmetadata",(function(){t.play()}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return y.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){this._hlsPolyfillInstance&&(this._hlsPolyfillInstance.destroy(),this._hlsPolyfillInstance=void 0),this._exoPlayer&&(window.removeEventListener("resize",this._resizeExoPlayer),this.hass.auth.external.fireMessage({type:"exoplayer/stop"}),this._exoPlayer=!1),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load())}},{kind:"method",key:"_resetError",value:function(){this._error=void 0,this._errorIsFatal=!1}},{kind:"method",key:"_setFatalError",value:function(e){this._error=e,this._errorIsFatal=!0,(0,_.B)(this,"streams",{hasAudio:!1,hasVideo:!1})}},{kind:"method",key:"_setRetryableError",value:function(e){this._error=e,this._errorIsFatal=!1,(0,_.B)(this,"streams",{hasAudio:!1,hasVideo:!1})}},{kind:"method",key:"_reportStreams",value:function(e){var t,r=null==e?void 0:e.split(",");(0,_.B)(this,"streams",{hasAudio:null!==(t=null==r?void 0:r.includes("mp4a"))&&void 0!==t&&t,hasVideo:null!=r&&r.includes("mp4a")?(null==r?void 0:r.length)>1:Boolean(null==r?void 0:r.length)})}},{kind:"method",key:"_loadedData",value:function(){(0,_.B)(this,"load")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,v.iv)(o||(o=(0,d.Z)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}.fatal{display:block;padding:100px 16px}.retry{display:block}"])))}}]}}),v.oi)}}]);
//# sourceMappingURL=48342.c917c084ab245d23.js.map