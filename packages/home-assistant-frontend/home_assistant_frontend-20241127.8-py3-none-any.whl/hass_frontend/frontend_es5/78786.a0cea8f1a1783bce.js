"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["78786"],{6736:function(t,e,a){a.d(e,{f:function(){return l}});var r=a(11655),n=a(27862),i=a(52565),s=a(92776),o=a(5776),d=a(21475),u=a(77204),c=(a(38419),a(19083),a(71695),a(42713),a(40251),a(61006),a(39527),a(36993),a(47021),a(50778)),l=function(t){var e=(0,d.Z)(null,(function(t,e){var a=function(e){function a(){var e;(0,i.Z)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=(0,s.Z)(this,a,[].concat(n)),t(e),e}return(0,o.Z)(a,e),(0,n.Z)(a)}(e);return{F:a,d:[{kind:"field",decorators:[(0,c.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,u.Z)(a,"connectedCallback",this,3)([]),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,u.Z)(a,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){var t=this.__unsubs.pop();t instanceof Promise?t.then((function(t){return t()})):t()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(t){if((0,u.Z)(a,"updated",this,3)([t]),t.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var e,n=(0,r.Z)(t.keys());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(this.hassSubscribeRequiredHostProps.includes(i))return void this.__checkSubscribed()}}catch(s){n.e(s)}finally{n.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var t,e=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(t=this.hassSubscribeRequiredHostProps)&&void 0!==t&&t.some((function(t){return void 0===e[t]}))||(this.__unsubs=this.hassSubscribe())}}]}}),t);return e}},20548:function(t,e,a){a.d(e,{H:function(){return i}});a(81804);var r=a(11259),n=a(4643);function i(t,e,a,i,s,o){var d=t.getPropertyValue(s+"-"+o).trim(),u=d.length>0?d:t.getPropertyValue(s).trim(),c=(0,r.Rq)(u);return 0===d.length&&o&&(c=(0,r.CO)((0,r.p3)(e?(0,n.C)((0,r.Rw)((0,r.wK)(c)),o):(0,n.W)((0,r.Rw)((0,r.wK)(c)),o)))),i?c+=a?"32":"7F":a&&(c+="7F"),c}},53259:function(t,e,a){a.a(t,(async function(t,r){try{a.d(e,{J:function(){return _}});a(38419),a(19423);var n=a(21893),i=a(13809),s=a(13633),o=a(38836),d=a(50602),u=a(46467),c=a(33570),l=t([u,c,d]);function f(t,e){var a=new Date(e);return t>2&&0===a.getHours()&&(a=(0,n.b)(a,1)),a.setMinutes(0,0,0),t>35&&a.setDate(1),t>2&&a.setHours(0),a.getTime()}function _(t,e,a,r,n,l,h){var _=(0,i.j)(e,t),g=void 0!==l&&void 0!==h;if(g&&_<=35){var v=(0,s.A)(e,t),y=(0,s.A)(h,l);y>v?e=(0,o.T)(e,y-v):v>y&&(h=(0,o.T)(h,v-y))}var b={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:f(_,e),adapters:{date:{locale:a,config:r}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(t){return t.tick&&t.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:_>35?"monthyear":_>7?"date":_>2?"weekday":_>0?"datetime":"hour",minUnit:_>35?"month":_>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:n},ticks:{beginAtZero:!0,callback:function(t){return(0,d.uf)(Math.abs(t),a)}}}},plugins:{tooltip:{position:"nearest",filter:function(t){return"0"!==t.formattedValue},itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:function(t){if(_>0)return t[0].label;var e=new Date(t[0].parsed.x);return"".concat(g?"".concat((0,u.ud)(e,a,r),": "):"").concat((0,c.mr)(e,a,r)," â€“ ").concat((0,c.mr)((0,o.T)(e,1),a,r))},label:function(t){return"".concat(t.dataset.label,": ").concat((0,d.uf)(t.parsed.y,a)," ").concat(n)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,d.Hd)(a)};return g&&(b.scales.xAxisCompare=Object.assign(Object.assign({},b.scales.x),{},{suggestedMin:l.getTime(),max:f(_,h),display:!1})),b}[u,c,d]=l.then?(await l)():l,r()}catch(h){r(h)}}))},32672:function(t,e,a){a.a(t,(async function(t,r){try{a.r(e),a.d(e,{HuiEnergyUsageGraphCard:function(){return I}});var n,i,s,o,d=a(22936),u=a(9833),c=a(10265),l=a(94524),h=a(11655),f=a(63038),_=a(27862),g=a(52565),v=a(92776),y=a(5776),b=a(21475),p=(a(38419),a(91599),a(26285),a(19083),a(71695),a(92745),a(61893),a(23509),a(19423),a(39304),a(52961),a(42713),a(37362),a(61427),a(92519),a(42179),a(89256),a(24931),a(88463),a(57449),a(19814),a(99341),a(39527),a(99790),a(41360),a(36993),a(49207),a(47021),a(42625)),m=a(83389),k=a(16444),x=a(57243),S=a(50778),Z=a(35359),j=a(27486),O=a(20548),w=a(50602),C=(a(25179),a(54977),a(1118)),E=a(17705),z=a(6736),D=a(93331),H=a(53259),A=t([C,H,w]);[C,H,w]=A.then?(await A)():A;var R={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},I=(0,b.Z)([(0,S.Mo)("hui-energy-usage-graph-card")],(function(t,e){var a,r=function(e){function a(){var e;(0,g.Z)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return e=(0,v.Z)(this,a,[].concat(n)),t(e),e}return(0,y.Z)(a,e),(0,_.Z)(a)}(e);return{F:r,d:[{kind:"field",decorators:[(0,S.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,S.SB)()],key:"_start",value:function(){return(0,p.I)()}},{kind:"field",decorators:[(0,S.SB)()],key:"_end",value:function(){return(0,m.p)()}},{kind:"field",decorators:[(0,S.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,S.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var t,e=this;return[(0,C.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((function(t){return e._getStatistics(t)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,D.SN)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,x.dy)(n||(n=(0,f.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,x.dy)(i||(i=(0,f.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,Z.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(t){return t.data.length}))?"":(0,x.dy)(s||(s=(0,f.Z)(['<div class="no-data"> '," </div>"])),(0,k.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):x.Ld}},{kind:"field",key:"_createOptions",value:function(){var t=this;return(0,j.Z)((function(e,a,r,n,i,s){var o=(0,H.J)(e,a,r,n,"kWh",i,s),d=Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{itemSort:function(t,e){var a,r,n,i,s;return(null===(a=t.raw)||void 0===a?void 0:a.y)>0&&(null===(r=e.raw)||void 0===r?void 0:r.y)<0?-1:(null===(n=e.raw)||void 0===n?void 0:n.y)>0&&(null===(i=t.raw)||void 0===i?void 0:i.y)<0?1:(null===(s=t.raw)||void 0===s?void 0:s.y)>0?e.datasetIndex-t.datasetIndex:t.datasetIndex-e.datasetIndex},callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(e){var a,n=0,i=0,s=(0,h.Z)(e);try{for(s.s();!(a=s.n()).done;){var o=a.value,d=o.dataset.data[o.dataIndex].y;d>0?n+=d:i+=Math.abs(d)}}catch(u){s.e(u)}finally{s.f()}return[n?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,w.uf)(n,r)}):"",i?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,w.uf)(i,r)}):""].filter(Boolean)}})})})});return d}))}},{kind:"method",key:"_getStatistics",value:(a=(0,l.Z)((0,u.Z)().mark((function t(e){var a,r,n,i,s,o,d,l,f,_,g,v,y,b;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],r={},n=(0,h.Z)(e.prefs.energy_sources),t.prev=3,n.s();case 5:if((i=n.n()).done){t.next=21;break}if("solar"!==(s=i.value).type){t.next=10;break}return r.solar?r.solar.push(s.stat_energy_from):r.solar=[s.stat_energy_from],t.abrupt("continue",19);case 10:if("battery"!==s.type){t.next=13;break}return r.to_battery?(r.to_battery.push(s.stat_energy_to),r.from_battery.push(s.stat_energy_from)):(r.to_battery=[s.stat_energy_to],r.from_battery=[s.stat_energy_from]),t.abrupt("continue",19);case 13:if("grid"===s.type){t.next=15;break}return t.abrupt("continue",19);case 15:o=(0,h.Z)(s.flow_from);try{for(o.s();!(d=o.n()).done;)l=d.value,r.from_grid?r.from_grid.push(l.stat_energy_from):r.from_grid=[l.stat_energy_from]}catch(u){o.e(u)}finally{o.f()}f=(0,h.Z)(s.flow_to);try{for(f.s();!(_=f.n()).done;)g=_.value,r.to_grid?r.to_grid.push(g.stat_energy_to):r.to_grid=[g.stat_energy_to]}catch(u){f.e(u)}finally{f.f()}case 19:t.next=5;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(3),n.e(t.t0);case 26:return t.prev=26,n.f(),t.finish(26);case 29:v=getComputedStyle(this),y={},Object.keys(R).forEach((function(t){y[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&r[t]&&Object.values(r[t]).forEach((function(e,a){y[t][e]=a}))})),b={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=e.start,this._end=e.end||(0,m.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,a.push.apply(a,(0,c.Z)(this._processDataSet(e.stats,e.statsMetadata,r,y,v,b,!1))),e.statsCompare&&(a.push({order:0,data:[]}),a.push({order:999,data:[],xAxisID:"xAxisCompare"}),a.push.apply(a,(0,c.Z)(this._processDataSet(e.statsCompare,e.statsMetadata,r,y,v,b,!0)))),this._chartData={datasets:a};case 40:case"end":return t.stop()}}),t,this,[[3,23,26,29]])}))),function(t){return a.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(t,e,a,r,n,i){var s,o=this,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=[],l={},f={};Object.entries(a).forEach((function(e){var a=(0,d.Z)(e,2),r=a[0],n=a[1],i=["solar","to_grid","from_grid","to_battery","from_battery"].includes(r),o=!["solar","from_battery"].includes(r),u={},c={};n.forEach((function(e){var a=t[e];if(a){var r={};a.forEach((function(t){if(null!==t.change&&void 0!==t.change){var e=t.change;i&&(u[t.start]=t.start in u?u[t.start]+e:e,s=t.end),o&&!(t.start in r)&&(r[t.start]=e,s=t.end)}})),c[e]=r}})),i&&(f[r]=u),o&&(l[r]=c)}));var _={},g={};if((f.to_grid||f.to_battery)&&f.solar){for(var v={},y=0,b=Object.keys(f.solar);y<b.length;y++){var p,m,k=b[y];if(v[k]=(f.solar[k]||0)-((null===(p=f.to_grid)||void 0===p?void 0:p[k])||0)-((null===(m=f.to_battery)||void 0===m?void 0:m[k])||0),v[k]<0){var x,S,Z;if(f.to_battery)if(_[k]=-1*v[k],_[k]>((null===(x=f.from_grid)||void 0===x?void 0:x[k])||0))g[k]=_[k]-((null===(S=f.from_grid)||void 0===S?void 0:S[k])||0),_[k]=null===(Z=f.from_grid)||void 0===Z?void 0:Z[k];v[k]=0}}l.used_solar={used_solar:v}}if(f.from_battery)if(f.to_grid){for(var j={},w=0,C=Object.keys(f.from_battery);w<C.length;w++){var z=C[w];j[z]=(f.from_battery[z]||0)-(g[z]||0)}l.used_battery={used_battery:j}}else l.used_battery={used_battery:f.from_battery};if(l.from_grid&&f.to_battery){for(var D={},H=function(){for(var t,e=I[A],a=0,r=0,n=Object.entries(l.from_grid);r<n.length;r++){var i=(0,d.Z)(n[r],2),s=i[0];if(i[1][e]&&(t=s,a++),a>1)break}if(1===a)l.from_grid[t][e]-=_[e]||0;else{var o=0;Object.values(l.from_grid).forEach((function(t){o+=t[e]||0,delete t[e]})),D[e]=o-(_[e]||0)}},A=0,I=Object.keys(_);A<I.length;A++)H();l.used_grid={used_grid:D}}var M=[];Object.values(l).forEach((function(t){Object.values(t).forEach((function(t){M=M.concat(Object.keys(t))}))}));var P=Array.from(new Set(M)).sort((function(t,e){return Number(t)-Number(e)}));return Object.entries(l).forEach((function(t){var a=(0,d.Z)(t,2),f=a[0],_=a[1];Object.entries(_).forEach((function(t,a){var _,g,v,y=(0,d.Z)(t,2),b=y[0],p=y[1],m=[],k=(0,h.Z)(P);try{for(k.s();!(v=k.n()).done;){var x=v.value,S=p[x]||0;m.push({x:Number(x),y:S&&["to_grid","to_battery"].includes(f)?-1*S:S})}}catch(Z){k.e(Z)}finally{k.f()}1===m.length&&m.push({x:s,y:0}),c.push({label:f in i?i[f]:(0,E.Kd)(o.hass,b,e[b]),order:"used_solar"===f?1:"to_battery"===f?Object.keys(l).length:a+2,borderColor:(0,O.H)(n,o.hass.themes.darkMode,!1,u,R[f],null===(_=r[f])||void 0===_?void 0:_[b]),backgroundColor:(0,O.H)(n,o.hass.themes.darkMode,!0,u,R[f],null===(g=r[f])||void 0===g?void 0:g[b]),stack:"stack",data:m,xAxisID:u?"xAxisCompare":void 0})}))})),c}},{kind:"get",static:!0,key:"styles",value:function(){return(0,x.iv)(o||(o=(0,f.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"])))}}]}}),(0,z.f)(x.oi));r()}catch(M){r(M)}}))},41924:function(t,e,a){a.d(e,{y:function(){return n}});var r=a(53907);function n(t){return(0,r.L)(t,Date.now())}},97836:function(t,e,a){a.d(e,{K:function(){return s}});var r=a(22936),n=a(18492),i=a(7591);function s(t,e,a){var s=(0,n.d)(null==a?void 0:a.in,t,e),o=(0,r.Z)(s,2),d=o[0],u=o[1];return+(0,i.b)(d)==+(0,i.b)(u)}},16444:function(t,e,a){a.d(e,{z:function(){return s}});var r=a(53907),n=a(41924),i=a(97836);function s(t,e){return(0,i.K)((0,r.L)((null==e?void 0:e.in)||t,t),(0,n.y)((null==e?void 0:e.in)||t))}}}]);
//# sourceMappingURL=78786.a0cea8f1a1783bce.js.map