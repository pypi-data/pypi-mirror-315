"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["51062"],{56615:function(t,i,e){e.r(i),e.d(i,{DEFAULT_DAYS_TO_SHOW:function(){return Z},HuiStatisticsGraphCard:function(){return S}});var s,n,a=e(38289),r=e(63038),o=e(9833),c=e(94524),h=e(27862),d=e(52565),u=e(92776),_=e(5776),l=e(21475),f=e(77204),v=(e(52247),e(38419),e(18801),e(71695),e(92745),e(63619),e(42713),e(37362),e(40251),e(99341),e(39527),e(67670),e(41360),e(49207),e(47021),e(57243)),g=e(50778),y=e(35359),k=(e(54977),e(17705)),p=e(69223),m=e(93331),w=e(29401),Z=30,S=(0,l.Z)([(0,g.Mo)("hui-statistics-graph-card")],(function(t,i){var l,S,T,b=function(i){function e(){var i;(0,d.Z)(this,e);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return i=(0,u.Z)(this,e,[].concat(n)),t(i),i}return(0,_.Z)(e,i),(0,h.Z)(e)}(i);return{F:b,d:[{kind:"method",static:!0,key:"getConfigElement",value:(T=(0,c.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.e("46379"),e.e("24199"),e.e("78943"),e.e("67390"),e.e("87593"),e.e("12633"),e.e("57606"),e.e("84266")]).then(e.bind(e,23656));case 2:return t.abrupt("return",document.createElement("hui-statistics-graph-card-editor"));case 3:case"end":return t.stop()}}),t)}))),function(){return T.apply(this,arguments)})},{kind:"method",static:!0,key:"getStubConfig",value:function(t,i,e){var s=(0,p.j)(t,1,i,e,["sensor"],(function(t){return"state_class"in t.attributes}));return{type:"statistics-graph",entities:s.length?[s[0]]:[]}}},{kind:"field",decorators:[(0,g.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_statistics",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_metadata",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_unit",value:void 0},{kind:"field",key:"_entities",value:function(){return[]}},{kind:"field",key:"_names",value:function(){return{}}},{kind:"field",key:"_interval",value:void 0},{kind:"field",key:"_statTypes",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,f.Z)(b,"disconnectedCallback",this,3)([]),this._interval&&(clearInterval(this._interval),this._interval=void 0)}},{kind:"method",key:"connectedCallback",value:function(){(0,f.Z)(b,"connectedCallback",this,3)([]),this.hasUpdated&&this._setFetchStatisticsTimer()}},{kind:"method",key:"getCardSize",value:function(){var t,i,e;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(i=this._config)&&void 0!==i&&i.hide_legend?0:(null===(e=this._entities)||void 0===e?void 0:e.length)||0)}},{kind:"method",key:"setConfig",value:function(t){var i=this;if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");var e=t.entities?(0,w.A)(t.entities,!1):[];this._entities=[],e.forEach((function(t){i._entities.push(t.entity),t.name&&(i._names[t.entity]=t.name)})),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,m.Wh)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){var i=this;if((0,f.Z)(b,"willUpdate",this,3)([t]),this._config&&t.has("_config")){var e=t.get("_config");t.has("_config")&&(null==e?void 0:e.entities)!==this._config.entities?this._getStatisticsMetaData(this._entities).then((function(){i._setFetchStatisticsTimer()})):!t.has("_config")||(null==e?void 0:e.stat_types)===this._config.stat_types&&(null==e?void 0:e.days_to_show)===this._config.days_to_show&&(null==e?void 0:e.period)===this._config.period&&(null==e?void 0:e.unit)===this._config.unit||this._setFetchStatisticsTimer()}}},{kind:"method",key:"_setFetchStatisticsTimer",value:function(){var t=this;this._getStatistics(),clearInterval(this._interval),this._interval=window.setInterval((function(){return t._getStatistics()}),this._intervalTimeout)}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,v.dy)(s||(s=(0,r.Z)([' <ha-card .header="','"> <div class="content ','"> <statistics-chart .hass="','" .isLoadingData="','" .statisticsData="','" .metadata="','" .period="','" .chartType="','" .statTypes="','" .names="','" .unit="','" .minYAxis="','" .maxYAxis="','" .fitYData="','" .hideLegend="','" .logarithmicScale="','"></statistics-chart> </div> </ha-card> '])),this._config.title,(0,y.$)({"has-header":!!this._config.title}),this.hass,!this._statistics,this._statistics,this._metadata,this._config.period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1):v.Ld}},{kind:"get",key:"_intervalTimeout",value:function(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}},{kind:"method",key:"_getStatisticsMetaData",value:(S=(0,c.Z)((0,o.Z)().mark((function t(i){var e,s;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,k.Py)(this.hass,i);case 2:e=t.sent,s={},e.forEach((function(t){s[t.statistic_id]=t})),this._metadata=s;case 6:case"end":return t.stop()}}),t,this)}))),function(t){return S.apply(this,arguments)})},{kind:"method",key:"_getStatistics",value:(l=(0,c.Z)((0,o.Z)().mark((function t(){var i,e,s,n,r,c,h=this;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new Date).setTime(i.getTime()-36e5*(24*(this._config.days_to_show||Z)+1)),t.prev=2,this._config.unit&&this._metadata&&(s=Object.values(this._metadata).find((function(t){return(0,k.dO)(h.hass,null==t?void 0:t.statistic_id,t)===h._config.unit})))&&(e=s.unit_class,this._unit=this._config.unit),!e&&this._metadata&&(n=this._metadata[this._entities[0]],e=null==n?void 0:n.unit_class,this._unit=e&&(0,k.dO)(this.hass,n.statistic_id,n)||void 0),r=e?(0,a.Z)({},e,this._unit):void 0,t.next=8,(0,k.dL)(this.hass,i,void 0,this._entities,this._config.period,r,this._statTypes);case 8:c=t.sent,this._statistics={},this._entities.forEach((function(t){t in c&&(h._statistics[t]=c[t])})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),this._statistics=void 0;case 16:case"end":return t.stop()}}),t,this,[[2,13]])}))),function(){return l.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,v.iv)(n||(n=(0,r.Z)(["ha-card{height:100%}.content{padding:16px}.has-header{padding-top:0}"])))}}]}}),v.oi)}}]);
//# sourceMappingURL=51062.77f743e0aaead578.js.map