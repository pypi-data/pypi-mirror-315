"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["79931"],{74564:function(e,t,i){i.d(t,{Z:function(){return a}});i(52247),i(95078),i(19134),i(97499),i(97003);var n=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("".concat(e," is not a number"));return t};function a(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:n(e.substr(0,e.length-1))};var t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:n(t[0]),h:1}:{w:n(t[0]),h:n(t[1])}}catch(i){}return null}},68424:function(e,t,i){var n,a,r,s,o,d,c,l,h=i("9833"),u=i("94524"),v=i("63038"),p=i("27862"),_=i("52565"),f=i("92776"),k=i("5776"),m=i("21475"),g=i("77204"),y=(i("38419"),i("57243")),b=i("50778"),C=i("91583"),I=i("27486"),w=i("47194"),S=i("75278"),Z=i("47844"),U=(i("96000"),i("19083"),i("92745"),i("42713"),i("40251"),i("39527"),i("41360"),i("49207"),i("20552")),x=i("36522"),O=(i("99426"),(0,m.Z)([(0,b.Mo)("ha-web-rtc-player")],(function(e,t){var i,s,o,d=function(t){function i(){var t;(0,_.Z)(this,i);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=(0,f.Z)(this,i,[].concat(a)),e(t),t}return(0,k.Z)(i,t),(0,p.Z)(i)}(t);return{F:d,d:[{kind:"field",decorators:[(0,b.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,b.Cb)()],key:"entityid",value:void 0},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({attribute:"poster-url"})],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,b.SB)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,b.IO)("#remote-stream")],key:"_videoEl",value:void 0},{kind:"field",key:"_clientConfig",value:void 0},{kind:"field",key:"_peerConnection",value:void 0},{kind:"field",key:"_remoteStream",value:void 0},{kind:"field",key:"_unsub",value:void 0},{kind:"field",key:"_sessionId",value:void 0},{kind:"field",key:"_candidatesList",value:function(){return[]}},{kind:"method",key:"render",value:function(){return this._error?(0,y.dy)(n||(n=(0,v.Z)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,y.dy)(a||(a=(0,v.Z)([' <video id="remote-stream" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" poster="','" @loadeddata="','"></video> '])),this.autoPlay,this.muted,this.playsInline,this.controls,(0,U.o)(this.posterUrl),this._loadedData)}},{kind:"method",key:"connectedCallback",value:function(){(0,g.Z)(d,"connectedCallback",this,3)([]),this.hasUpdated&&this.entityid&&this._startWebRtc()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,g.Z)(d,"disconnectedCallback",this,3)([]),this._cleanUp()}},{kind:"method",key:"willUpdate",value:function(e){(0,g.Z)(d,"willUpdate",this,3)([e]),e.has("entityid")&&this._startWebRtc()}},{kind:"method",key:"_startWebRtc",value:(o=(0,u.Z)((0,h.Z)().mark((function e(){var t=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cleanUp(),"undefined"!=typeof RTCPeerConnection){e.next=5;break}return this._error="WebRTC is not supported in this browser",(0,x.B)(this,"streams",{hasAudio:!1,hasVideo:!1}),e.abrupt("return");case 5:if(this.hass&&this.entityid){e.next=7;break}return e.abrupt("return");case 7:return this._error=void 0,this._startTimer(),this._logEvent("start clientConfig"),e.next=12,(0,Z.z9)(this.hass,this.entityid);case 12:this._clientConfig=e.sent,this._logEvent("end clientConfig",this._clientConfig),this._peerConnection=new RTCPeerConnection(this._clientConfig.configuration),this._clientConfig.dataChannel&&this._peerConnection.createDataChannel(this._clientConfig.dataChannel),this._peerConnection.onnegotiationneeded=this._startNegotiation,this._peerConnection.onicecandidate=this._handleIceCandidate,this._peerConnection.oniceconnectionstatechange=this._iceConnectionStateChanged,this._peerConnection.onsignalingstatechange=function(e){"stable"===e.target.signalingState?t._logEvent("ICE negotiation complete"):t._logEvent("Signaling state changed",e.target.signalingState)},this._remoteStream=new MediaStream,this._peerConnection.ontrack=this._addTrack,this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),this._peerConnection.addTransceiver("video",{direction:"recvonly"});case 24:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{kind:"field",key:"_startNegotiation",value:function(){var e=this;return(0,u.Z)((0,h.Z)().mark((function t(){var i,n,a,r,s,o;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._peerConnection){t.next=2;break}return t.abrupt("return");case 2:return n={offerToReceiveAudio:!0,offerToReceiveVideo:!0},e._logEvent("start createOffer",n),t.next=6,e._peerConnection.createOffer(n);case 6:if(a=t.sent,e._peerConnection){t.next=9;break}return t.abrupt("return");case 9:return e._logEvent("end createOffer",a),e._logEvent("start setLocalDescription"),t.next=13,e._peerConnection.setLocalDescription(a);case 13:if(e._peerConnection&&e.entityid){t.next=15;break}return t.abrupt("return");case 15:if(e._logEvent("end setLocalDescription"),r="",null===(i=e._clientConfig)||void 0===i||!i.getCandidatesUpfront){t.next=22;break}return t.next=20,new Promise((function(t){e._peerConnection.onicegatheringstatechange=function(i){var n=i.target.iceGatheringState;"complete"===n&&(e._peerConnection.onicegatheringstatechange=null,t()),e._logEvent("Ice gathering state changed",n)}}));case 20:if(e._peerConnection&&e.entityid){t.next=22;break}return t.abrupt("return");case 22:for(;e._candidatesList.length;)(s=e._candidatesList.pop())&&(r+="a=".concat(s,"\r\n"));o=a.sdp+r,e._logEvent("start webRtcOffer",o);try{e._unsub=(0,Z.T9)(e.hass,e.entityid,o,(function(t){return e._handleOfferEvent(t)}))}catch(d){e._error="Failed to start WebRTC stream: "+d.message,e._cleanUp()}case 26:case"end":return t.stop()}}),t)})))}},{kind:"field",key:"_iceConnectionStateChanged",value:function(){var e=this;return function(){var t,i;e._logEvent("ice connection state change",null===(t=e._peerConnection)||void 0===t?void 0:t.iceConnectionState),"failed"===(null===(i=e._peerConnection)||void 0===i?void 0:i.iceConnectionState)&&e._peerConnection.restartIce()}}},{kind:"method",key:"_handleOfferEvent",value:(s=(0,u.Z)((0,h.Z)().mark((function e(t){var i,n,a=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.entityid){e.next=2;break}return e.abrupt("return");case 2:if("session"===t.type&&(this._sessionId=t.session_id,this._candidatesList.forEach((function(e){return(0,Z.r)(a.hass,a.entityid,t.session_id,e.toJSON())})),this._candidatesList=[]),"answer"===t.type&&(this._logEvent("answer",t.answer),this._handleAnswer(t)),"candidate"!==t.type){e.next=15;break}return this._logEvent("remote ice candidate",t.candidate),e.prev=6,n=t.candidate.sdpMid||null!=t.candidate.sdpMLineIndex?new RTCIceCandidate(t.candidate):new RTCIceCandidate({candidate:t.candidate.candidate,sdpMid:"0"}),e.next=10,null===(i=this._peerConnection)||void 0===i?void 0:i.addIceCandidate(n);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),console.error(e.t0);case 15:"error"===t.type&&(this._error="Failed to start WebRTC stream: "+t.message,this._cleanUp());case 16:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e){return s.apply(this,arguments)})},{kind:"field",key:"_handleIceCandidate",value:function(){var e=this;return function(t){var i,n,a;e.entityid&&null!==(i=t.candidate)&&void 0!==i&&i.candidate&&(e._logEvent("local ice candidate",null===(n=t.candidate)||void 0===n?void 0:n.candidate,null===(a=t.candidate)||void 0===a?void 0:a.sdpMLineIndex),e._sessionId?(0,Z.r)(e.hass,e.entityid,e._sessionId,t.candidate.toJSON()):e._candidatesList.push(t.candidate))}}},{kind:"field",key:"_addTrack",value:function(){var e=this;return function(){var t=(0,u.Z)((0,h.Z)().mark((function t(i){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._remoteStream){t.next=2;break}return t.abrupt("return");case 2:if(e._remoteStream.addTrack(i.track),e.hasUpdated){t.next=6;break}return t.next=6,e.updateComplete;case 6:e._videoEl.srcObject=e._remoteStream;case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},{kind:"method",key:"_handleAnswer",value:(i=(0,u.Z)((0,h.Z)().mark((function e(t){var i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(i=this._peerConnection)&&void 0!==i&&i.signalingState&&!["stable","closed"].includes(this._peerConnection.signalingState)){e.next=2;break}return e.abrupt("return");case 2:return n=new RTCSessionDescription({type:"answer",sdp:t.answer}),e.prev=3,this._logEvent("start setRemoteDescription",n),e.next=7,this._peerConnection.setRemoteDescription(n);case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),this._error="Failed to connect WebRTC stream: "+e.t0.message,this._cleanUp();case 13:this._logEvent("end setRemoteDescription");case 14:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return i.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){var e;this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop()})),this._remoteStream=void 0);var t=this._videoEl;t&&(t.removeAttribute("src"),t.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection.onnegotiationneeded=null,this._peerConnection.onicecandidate=null,this._peerConnection.oniceconnectionstatechange=null,this._peerConnection.onicegatheringstatechange=null,this._peerConnection.ontrack=null,this._peerConnection.onsignalingstatechange=null,this._peerConnection=void 0,this._logEvent("stopped"),this._stopTimer()),null===(e=this._unsub)||void 0===e||e.then((function(e){return e()})),this._unsub=void 0,this._sessionId=void 0,this._candidatesList=[]}},{kind:"method",key:"_loadedData",value:function(){var e=this._videoEl.srcObject,t={hasAudio:Boolean(null==e?void 0:e.getAudioTracks().length),hasVideo:Boolean(null==e?void 0:e.getVideoTracks().length)};(0,x.B)(this,"load"),(0,x.B)(this,"streams",t),this._logEvent("loadedData",t),this._stopTimer()}},{kind:"method",key:"_startTimer",value:function(){}},{kind:"method",key:"_stopTimer",value:function(){}},{kind:"method",key:"_logEvent",value:function(e){}},{kind:"get",static:!0,key:"styles",value:function(){return(0,y.iv)(r||(r=(0,v.Z)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}"])))}}]}}),y.oi),"mjpeg");(0,m.Z)([(0,b.Mo)("ha-camera-stream")],(function(e,t){var i,n,a=function(t){function i(){var t;(0,_.Z)(this,i);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=(0,f.Z)(this,i,[].concat(a)),e(t),t}return(0,k.Z)(i,t),(0,p.Z)(i)}(t);return{F:a,d:[{kind:"field",decorators:[(0,b.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,b.Cb)({attribute:!1})],key:"stateObj",value:void 0},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,b.Cb)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,b.SB)()],key:"_posterUrl",value:void 0},{kind:"field",decorators:[(0,b.SB)()],key:"_connected",value:function(){return!1}},{kind:"field",decorators:[(0,b.SB)()],key:"_capabilities",value:void 0},{kind:"field",decorators:[(0,b.SB)()],key:"_hlsStreams",value:void 0},{kind:"field",decorators:[(0,b.SB)()],key:"_webRtcStreams",value:void 0},{kind:"method",key:"willUpdate",value:function(e){var t;e.has("stateObj")&&this.stateObj&&(null===(t=e.get("stateObj"))||void 0===t?void 0:t.entity_id)!==this.stateObj.entity_id&&(this._getCapabilities(),this._getPosterUrl())}},{kind:"method",key:"connectedCallback",value:function(){(0,g.Z)(a,"connectedCallback",this,3)([]),this._connected=!0}},{kind:"method",key:"disconnectedCallback",value:function(){(0,g.Z)(a,"disconnectedCallback",this,3)([]),this._connected=!1}},{kind:"method",key:"render",value:function(){var e,t=this;if(!this.stateObj)return y.Ld;var i=this._streams(null===(e=this._capabilities)||void 0===e?void 0:e.frontend_stream_types,this._hlsStreams,this._webRtcStreams);return(0,y.dy)(s||(s=(0,v.Z)(["",""])),(0,C.r)(i,(function(e){return e.type+t.stateObj.entity_id}),(function(e){return t._renderStream(e)})))}},{kind:"method",key:"_renderStream",value:function(e){return this.stateObj?e.type===O?(0,y.dy)(o||(o=(0,v.Z)(['<img .src="','" alt="','">'])),this._connected?(0,Z.nk)(this.stateObj):this._posterUrl||"","Preview of the ".concat((0,w.C)(this.stateObj)," camera.")):e.type===Z.kU?(0,y.dy)(d||(d=(0,v.Z)(['<ha-hls-player autoplay playsinline .allowExoPlayer="','" .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','"></ha-hls-player>'])),this.allowExoPlayer,this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleHlsStreams,e.visible?"":"hidden"):e.type===Z.jU?(0,y.dy)(c||(c=(0,v.Z)(['<ha-web-rtc-player autoplay playsinline .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','"></ha-web-rtc-player>'])),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleWebRtcStreams,e.visible?"":"hidden"):y.Ld:y.Ld}},{kind:"method",key:"_getCapabilities",value:(n=(0,u.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._capabilities=void 0,this._hlsStreams=void 0,this._webRtcStreams=void 0,(0,S.e)(this.stateObj,Z.qW)){e.next=6;break}return this._capabilities={frontend_stream_types:[]},e.abrupt("return");case 6:return e.next=8,(0,Z.ou)(this.hass,this.stateObj.entity_id);case 8:this._capabilities=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{kind:"method",key:"_getPosterUrl",value:(i=(0,u.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,Z.i4)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 3:this._posterUrl=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this._posterUrl=void 0;case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_handleHlsStreams",value:function(e){this._hlsStreams=e.detail}},{kind:"method",key:"_handleWebRtcStreams",value:function(e){this._webRtcStreams=e.detail}},{kind:"field",key:"_streams",value:function(){return(0,I.Z)((function(e,t,i){if(!e)return[];if(0===e.length)return[{type:O,visible:!0}];if(1===e.length)return e[0]===Z.kU&&!1===(null==t?void 0:t.hasVideo)||e[0]===Z.jU&&!1===(null==i?void 0:i.hasVideo)?[{type:O,visible:!0}]:[{type:e[0],visible:!0}];if(t&&i)return t.hasVideo&&t.hasAudio&&!i.hasAudio?[{type:Z.kU,visible:!0}]:i.hasVideo?[{type:Z.jU,visible:!0}]:[{type:O,visible:!0}];if((null==t?void 0:t.hasVideo)!==(null==i?void 0:i.hasVideo)){if(null!=t&&t.hasVideo)return[{type:Z.kU,visible:!0},{type:Z.jU,visible:!1}];if(!1===(null==t?void 0:t.hasVideo))return[{type:Z.jU,visible:!0}];if(null!=i&&i.hasVideo)return[{type:Z.jU,visible:!0},{type:Z.kU,visible:!1}];if(!1===(null==i?void 0:i.hasVideo))return[{type:Z.kU,visible:!0}]}return[{type:Z.kU,visible:!0},{type:Z.jU,visible:!1}]}))}},{kind:"get",static:!0,key:"styles",value:function(){return(0,y.iv)(l||(l=(0,v.Z)([":host,img{display:block}img{width:100%}.hidden{display:none}"])))}}]}}),y.oi)},72099:function(e,t,i){i.d(t,{U:function(){return n}});i(38419);var n=function(e){return"/api/image_proxy/".concat(e.entity_id,"?token=").concat(e.attributes.access_token,"&state=").concat(e.state)}},33755:function(e,t,i){var n,a,r,s,o,d,c=i(9833),l=i(94524),h=i(63038),u=i(27862),v=i(52565),p=i(92776),_=i(5776),f=i(21475),k=i(77204),m=(i(38419),i(91599),i(19083),i(49278),i(42713),i(61006),i(39527),i(99790),i(57243)),g=i(50778),y=i(35359),b=i(69634),C=i(73358),I=i(73850),w=i(74564),S=(i(68424),i(97206),i(47844)),Z=i(96194),U=i(72099),x=function(e){return e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error",e}(x||{});(0,f.Z)([(0,g.Mo)("hui-image")],(function(e,t){var i,f,O,E,L=function(t){function i(){var t;(0,v.Z)(this,i);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=(0,p.Z)(this,i,[].concat(a)),e(t),t}return(0,_.Z)(i,t),(0,u.Z)(i)}(t);return{F:L,d:[{kind:"field",decorators:[(0,g.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"image",value:void 0},{kind:"field",decorators:[(0,g.Cb)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,g.Cb)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,g.Cb)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_imageVisible",value:function(){return!1}},{kind:"field",decorators:[(0,g.SB)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,g.SB)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:function(){return null}},{kind:"method",key:"connectedCallback",value:function(){(0,k.Z)(L,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=x.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,k.Z)(L,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(e){if(e.has("hass")){var t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=x.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,w.Z)(this.aspectRatio):null),this._loadState!==x.Loading||this.cameraImage||(this._loadState=x.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return m.Ld;var e,t,i=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),d=this.entity?this.hass.states[this.entity]:void 0,c=d?d.state:Z.nZ,l=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?t=this.hass.states[this.cameraImage]:e=this._cameraImageSrc;else if(this.stateImage){var u=this.stateImage[c];u?e=u:(e=this.image,l=!0)}else e=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:d&&"image"===(0,I.M)(d.entity_id)?(0,U.U)(d):this.image;e&&(e=this.hass.hassUrl(e));var v=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(v+=this.darkModeFilter),this.stateFilter&&this.stateFilter[c]&&(v+=this.stateFilter[c]),!v&&this.entity)&&(v=(!d||C.tj.includes(c))&&l?"grayscale(100%)":"");return(0,m.dy)(n||(n=(0,h.Z)([' <div style="','" class="container ','"> '," "," </div> "])),(0,b.V)({paddingBottom:i?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:i&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:this._loadState===x.Loaded||"live"===this.cameraView?v:void 0}),(0,y.$)({ratio:i||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,m.dy)(a||(a=(0,h.Z)([' <ha-camera-stream muted .hass="','" .stateObj="','" @load="','"></ha-camera-stream> '])),this.hass,t,this._onVideoLoad):void 0===e?m.Ld:(0,m.dy)(r||(r=(0,h.Z)([' <img id="image" src="','" @error="','" @load="','" style="','"> '])),e,this._onImageError,this._onImageLoad,(0,b.V)({display:i||this._loadState===x.Loaded?"block":"none"})),this._loadState===x.Error?(0,m.dy)(s||(s=(0,h.Z)(['<div id="brokenImage" style="','"></div>'])),(0,b.V)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})):"live"===this.cameraView||void 0!==e&&this._loadState!==x.Loading?"":(0,m.dy)(o||(o=(0,h.Z)(['<div class="progress-container" style="','"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>'])),(0,b.V)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})))}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){var e=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((function(){return e._updateCameraImageSrcAtInterval()}),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=x.Error}},{kind:"method",key:"_onImageLoad",value:(E=(0,l.Z)((0,c.Z)().mark((function e(t){var i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=x.Loaded,i=t.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=i.src),e.next=5,this.updateComplete;case 5:this._lastImageHeight=i.offsetHeight;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{kind:"method",key:"_onVideoLoad",value:(O=(0,l.Z)((0,c.Z)().mark((function e(t){var i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=x.Loaded,i=t.currentTarget,e.next=4,this.updateComplete;case 4:this._lastImageHeight=i.offsetHeight;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:(f=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState===x.Loading&&this._onImageError(),e.abrupt("return",this._updateCameraImageSrc());case 2:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrc",value:(i=(0,l.Z)((0,c.Z)().mark((function e(){var t,i,n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hass&&this.cameraImage){e.next=2;break}return e.abrupt("return");case 2:if(this.hass.states[this.cameraImage]){e.next=6;break}return this._onImageError(),e.abrupt("return");case 6:return t=this.clientWidth||640,i=Math.ceil(t*devicePixelRatio),this._lastImageHeight?n=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?n=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,n=Math.ceil(.5625*i)),e.next=11,(0,S.i4)(this.hass,this.cameraImage,i,n);case 11:this._cameraImageSrc=e.sent,void 0===this._cameraImageSrc&&this._onImageError();case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,m.iv)(d||(d=(0,h.Z)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}'])))}}]}}),m.oi)}}]);
//# sourceMappingURL=79931.5a818e412c8c245b.js.map