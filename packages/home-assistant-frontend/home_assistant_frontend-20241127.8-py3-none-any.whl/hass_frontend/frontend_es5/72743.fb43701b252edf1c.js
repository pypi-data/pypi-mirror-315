"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["72743"],{97674:function(e,t,n){n.a(e,(async function(e,r){try{n.d(t,{AH:function(){return c},Ai:function(){return f},vA:function(){return s}});var o=n(35895),i=n(20382),a=e([o]);o=(a.then?(await a)():a)[0];var u=function(e,t,n,r){var i=n((0,o.zW)(e,t),r);return i instanceof Date?(0,o.Nm)(i,t):i},c=function(e,t,n,r,o){return n.time_zone===i.c_.server?u(e,r.time_zone,t,o):t(e,o)},s=function(e,t,n,r,o){return n.time_zone===i.c_.server?u(e,r.time_zone,t,o):t(e,o)},f=function(e,t,n,r,a){return s(e,n,r,a,r.time_zone===i.c_.server?(0,o.zW)(t,a.time_zone):t)};r()}catch(l){r(l)}}))},47558:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(11655),o=(n(92745),function(e,t){var n,o={},i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t(a);u in o?o[u].push(a):o[u]=[a]}}catch(c){i.e(c)}finally{i.f()}return o})},75101:function(e,t,n){n.d(t,{DJ:function(){return a},LZ:function(){return o},Nn:function(){return l},Ny:function(){return _},Pk:function(){return g},Q4:function(){return i},RQ:function(){return c},SO:function(){return s},T0:function(){return y},iJ:function(){return f},pB:function(){return u}});var r=n(10265),o=(n(38419),n(91599),n(18801),n(19423),n(42713),n(39527),n(99790),n(67670),99387==n.j?["migration_error","setup_error","setup_retry"]:null),i=99387==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,a=function(e,t,n){var r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((function(e){return t(e)}),r)},u=function(e,t){var n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get"},n))},c=function(e,t){return e.callWS({type:"config_entries/get_single",entry_id:t})},s=function(e,t,n){return e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n))},f=function(e,t){return e.callApi("DELETE","config/config_entries/entry/".concat(t))},l=function(e,t){return e.callApi("POST","config/config_entries/entry/".concat(t,"/reload"))},_=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"})},y=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null})},g=function(e,t){if(!t)return e;var n=e.find((function(e){return e.entry_id===t}));if(!n)return e;var o=e.filter((function(e){return e.entry_id!==t}));return[n].concat((0,r.Z)(o))}},1118:function(e,t,n){n.a(e,(async function(e,r){try{n.d(t,{Bm:function(){return A},Cj:function(){return H},E4:function(){return ee},EH:function(){return Y},G9:function(){return R},Jj:function(){return M},KU:function(){return O},P:function(){return C},UB:function(){return U},ZC:function(){return L},_Z:function(){return B},b:function(){return V},gy:function(){return z},iK:function(){return x},jB:function(){return q},kJ:function(){return X},o1:function(){return D},rl:function(){return W},vE:function(){return F},xZ:function(){return P},yH:function(){return K}});var o=n(22936),i=n(10265),a=n(11655),u=n(9833),c=n(94524),s=(n(52247),n(38419),n(19083),n(71695),n(64228),n(92745),n(19423),n(39304),n(52961),n(42713),n(37362),n(40251),n(61006),n(99341),n(88044),n(39527),n(41360),n(13334),n(49207),n(47021),n(13809)),f=n(86319),l=n(3938),_=n(23459),y=n(6542),g=n(32424),p=n(23711),d=n(7591),m=n(96500),v=n(38836),h=n(62212),b=n(27486),w=n(97674),Z=n(33570),k=n(47558),T=n(75101),E=n(17705),j=e([Z,w]);[Z,w]=j.then?(await j)():j;var S=[],A=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},D=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},x=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},W=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},C=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},O=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},H=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},P=function(e){return e.callWS({type:"energy/info"})},z=99387==n.j?(re=(0,c.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)}))),function(e){return re.apply(this,arguments)}):null,L=function(e){return e.callWS({type:"energy/get_prefs"})},B=99387==n.j?(ne=(0,c.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),I(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return ne.apply(this,arguments)}):null,J=function(){var e=(0,c.Z)((0,u.Z)().mark((function e(t,n,r,o,i){var a,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>5&&void 0!==c[5]?c[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:a}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),M=function(e){return(0,k.v)(e.energy_sources,(function(e){return e.type}))},K=function(e,t,n){var r,o=[],u=(0,a.Z)(e.energy_sources);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(!n||n.includes(c.type))if("solar"!==c.type)if("gas"!==c.type&&"water"!==c.type)if("battery"!==c.type){var s,f=(0,a.Z)(c.flow_from);try{for(f.s();!(s=f.n()).done;){var l=s.value;o.push(l.stat_energy_from),l.stat_cost&&o.push(l.stat_cost);var _=t.cost_sensors[l.stat_energy_from];_&&o.push(_)}}catch(v){f.e(v)}finally{f.f()}var y,g=(0,a.Z)(c.flow_to);try{for(g.s();!(y=g.n()).done;){var p=y.value;o.push(p.stat_energy_to),p.stat_compensation&&o.push(p.stat_compensation);var d=t.cost_sensors[p.stat_energy_to];d&&o.push(d)}}catch(v){g.e(v)}finally{g.f()}}else o.push(c.stat_energy_from),o.push(c.stat_energy_to);else{o.push(c.stat_energy_from),c.stat_cost&&o.push(c.stat_cost);var m=t.cost_sensors[c.stat_energy_from];m&&o.push(m)}else o.push(c.stat_energy_from)}}catch(v){u.e(v)}finally{u.f()}return n&&!n.includes("device")||o.push.apply(o,(0,i.Z)(e.device_consumption.map((function(e){return e.stat_consumption})))),o},N=function(){var e=(0,c.Z)((0,u.Z)().mark((function e(t,n,r,c,d){var m,v,h,b,Z,k,j,S,A,D,x,W,C,O,H,z,L,B,M,N,I,Q,U,q,G,R,F,V,X,Y,$,ee,te,ne,re,oe,ie,ae,ue,ce,se,fe,le,_e,ye,ge,pe;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,T.pB)(t,{domain:"co2signal"}),P(t)]);case 2:if(m=e.sent,v=(0,o.Z)(m,2),h=v[0],b=v[1],!(Z=h.length?h[0]:void 0)){e.next=21;break}j=0,S=Object.values(t.entities);case 9:if(!(j<S.length)){e.next=21;break}if("co2signal"===(A=S[j]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((D=t.states[A.entity_id])&&"%"===D.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return k=D.entity_id,e.abrupt("break",21);case 18:j++,e.next=9;break;case 21:x=[],W=(0,a.Z)(n.energy_sources);try{for(W.s();!(C=W.n()).done;)if("grid"===(O=C.value).type){H=(0,a.Z)(O.flow_from);try{for(H.s();!(z=H.n()).done;)L=z.value,x.push(L.stat_energy_from)}catch(u){H.e(u)}finally{H.f()}}}catch(u){W.e(u)}finally{W.f()}return B=K(n,b,["grid","solar","battery","gas","device"]),M=K(n,b,["water"]),N=[].concat((0,i.Z)(B),(0,i.Z)(M)),I=(0,s.j)(c||new Date,r),Q=I>35?"month":I>2?"day":"hour",U=t.config.unit_system.length||"",q={energy:"kWh",volume:"km"===U?"m³":"ft³"},G={volume:"km"===U?"L":"gal"},R=B.length?(0,E.dL)(t,r,c,B,Q,q,["change"]):{},F=M.length?(0,E.dL)(t,r,c,M,Q,G,["change"]):{},$={},ee={},d&&(X=(0,w.vA)(r,f.b,t.locale,t.config)&&(0,w.vA)(c||new Date,l.h,t.locale,t.config)?(0,w.AH)(r,_.z,t.locale,t.config,-(0,w.Ai)(c||new Date,r,y.d,t.locale,t.config)-1):(0,w.AH)(r,g.E,t.locale,t.config,-1*(I+1)),Y=(0,p.n)(r,-1),B.length&&($=(0,E.dL)(t,X,Y,B,Q,q,["change"])),M.length&&(ee=(0,E.dL)(t,X,Y,M,Q,G,["change"]))),void 0!==k&&(te=J(t,r,x,k,c,I>35?"month":I>2?"day":"hour"),d&&(ne=J(t,X,x,k,Y,I>35?"month":I>2?"day":"hour"))),re={},oe=N.length?(0,E.Py)(t,N):[],e.next=42,Promise.all([R,F,$,ee,oe,te,ne]);case 42:return ie=e.sent,ae=(0,o.Z)(ie,7),ue=ae[0],ce=ae[1],se=ae[2],fe=ae[3],le=ae[4],_e=ae[5],ye=ae[6],ge=Object.assign(Object.assign({},ue),ce),d&&(V=Object.assign(Object.assign({},se),fe)),N.length&&le.forEach((function(e){re[e.statistic_id]=e})),pe={start:r,end:c,startCompare:X,endCompare:Y,info:b,prefs:n,stats:ge,statsMetadata:re,statsCompare:V,co2SignalConfigEntry:Z,co2SignalEntity:k,fossilEnergyConsumption:_e,fossilEnergyConsumptionCompare:ye},e.abrupt("return",pe);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),I=function(e){S.forEach((function(t){var n=U(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},Q=function(e){if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){var t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((function(){return e.refresh()}),t.getTime()-Date.now())}},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];S.push(t.key);var r=(0,h._)(e.connection,n,(0,c.Z)((0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,L(e);case 3:r.prefs=t.sent;case 4:return Q(r),t.abrupt("return",N(e,r.prefs,r.start,r.end,r.compare));case 6:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,void 0===r._refreshTimeout&&Q(r),function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var i=new Date,a=(0,Z.Zs)(i,e.locale,e.config).split(":")[0];r.start=(0,w.AH)("0"===a?(0,g.E)(i,-1):i,d.b,e.locale,e.config),r.end=(0,w.AH)("0"===a?(0,g.E)(i,-1):i,m.i,e.locale,e.config);var s=function(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,w.AH)(new Date,d.b,e.locale,e.config),r.end=(0,w.AH)(new Date,m.i,e.locale,e.config),s()}),(0,v.T)((0,w.AH)(i,m.i,e.locale,e.config),1).getTime()-Date.now())};return s(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var o;r.start=t,r.end=n,r.start.getTime()!==(0,w.AH)(new Date,d.b,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,w.AH)(new Date,m.i,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):s()},r.setCompare=function(e){r.compare=e},r},q=function(e){return e.callWS({type:"energy/solar_forecast"})},G=["volume","energy"],R=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,a.Z)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=n[i.stat_energy_from];if(G.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(c){o.e(c)}finally{o.f()}},F=function(e,t){var n=R(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m³":"ft³"},V=function(e){return"km"===e.config.unit_system.length?"L":"gal"},X="/docs/energy/faq/#troubleshooting-missing-entities",Y=(0,b.Z)((function(e){return{summedData:$(e),compareSummedData:e.statsCompare?$(e,!0):void 0}})),$=function(e,t){var n,r={},i=(0,a.Z)(e.prefs.energy_sources);try{for(i.s();!(n=i.n()).done;){var u=n.value;if("solar"!==u.type)if("battery"!==u.type){if("grid"===u.type){var c,s=(0,a.Z)(u.flow_from);try{for(s.s();!(c=s.n()).done;){var f=c.value;r.from_grid?r.from_grid.push(f.stat_energy_from):r.from_grid=[f.stat_energy_from]}}catch(p){s.e(p)}finally{s.f()}var l,_=(0,a.Z)(u.flow_to);try{for(_.s();!(l=_.n()).done;){var y=l.value;r.to_grid?r.to_grid.push(y.stat_energy_to):r.to_grid=[y.stat_energy_to]}}catch(p){_.e(p)}finally{_.f()}}}else r.to_battery?(r.to_battery.push(u.stat_energy_to),r.from_battery.push(u.stat_energy_from)):(r.to_battery=[u.stat_energy_to],r.from_battery=[u.stat_energy_from]);else r.solar?r.solar.push(u.stat_energy_from):r.solar=[u.stat_energy_from]}}catch(p){i.e(p)}finally{i.f()}var g={};return Object.entries(r).forEach((function(n){var r=(0,o.Z)(n,2),i=r[0],a=r[1],u={},c={};a.forEach((function(n){var r=t?e.statsCompare[n]:e.stats[n];if(r){r.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;u[e.start]=e.start in u?u[e.start]+t:t}})),c[n]={}}})),g[i]=u})),g},ee=(0,b.Z)((function(e,t){return{consumption:te(e),compareConsumption:t?te(t):void 0}})),te=function(e){var t={total:{}};return Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(n){if(void 0===t.total[n]){var r,o,i,a,u,c=((null===(r=e.from_grid)||void 0===r?void 0:r[n])||0)+((null===(o=e.solar)||void 0===o?void 0:o[n])||0)+((null===(i=e.from_battery)||void 0===i?void 0:i[n])||0)-((null===(a=e.to_grid)||void 0===a?void 0:a[n])||0)-((null===(u=e.to_battery)||void 0===u?void 0:u[n])||0);t.total[n]=c}}))})),t};r()}catch(oe){r(oe)}var ne,re}))}}]);
//# sourceMappingURL=72743.fb43701b252edf1c.js.map