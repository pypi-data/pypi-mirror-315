<script type="text/javascript" src="/assets/plugins/golden-layout/goldenlayout.min.js"></script>
<link type="text/css" rel="stylesheet" href="/assets/plugins/golden-layout/goldenlayout-base.css" />
<link type="text/css" rel="stylesheet" href="/assets/plugins/golden-layout/goldenlayout-dark-theme.css" />

<div id="layout" style="widxth: 100%; height: 100vh;"></div>
<webc-events-utils></webc-events-utils>

<script>
    $(function() {
        let system_prompt_1 = 'only speak in English'
        let system_prompt_2 = 'only speak in Mandarin'
        let system_prompt_3 = 'only speak in Hindi'
        let system_prompt_4 = 'only speak in Bengali'
        let system_prompt_5 = 'only speak in Russian'
        let system_prompt_6 = 'only speak in Portuguese'
        var chatbotConfig = [
            { name: "chatbot (English)"   , platform: "Groq (Free)", provider: "3. Google"   , model: "gemma-7b-it"        , channel: "MODEL-1" , system_prompt:system_prompt_1},
            //{ name: "chatbot (Mandarin)"  , platform: "Groq (Free)", provider: "Meta"     , model: "llama3-70b-8192"    , channel: "MODEL-2" , system_prompt:system_prompt_2},
            { name: "chatbot (Mandarin)"  , platform: "Groq (Free)", provider: "3. Google"     , model: "gemma-7b-it"    , channel: "MODEL-2" , system_prompt:system_prompt_2},
            { name: "chatbot (Hindi)"      , platform: "Groq (Free)", provider: "2. Mistral"  , model: "mixtral-8x7b-32768" , channel: "MODEL-3" , system_prompt:system_prompt_3},
            { name: "chatbot (Bengali)"    , platform: "Groq (Free)", provider: "3. Google"   , model: "gemma-7b-it"        , channel: "MODEL-4" , system_prompt:system_prompt_4},
            //{ name: "chatbot (Russian)"    , platform: "Groq (Free)", provider: "Meta"     , model: "llama3-70b-8192"    , channel: "MODEL-5" , system_prompt:system_prompt_2},
            { name: "chatbot (Russian)"    , platform: "Groq (Free)", provider: "3. Google"     , model: "gemma-7b-it"    , channel: "MODEL-5" , system_prompt:system_prompt_5},
            { name: "chatbot (Portuguese)" , platform: "Groq (Free)", provider: "2. Mistral"  , model: "mixtral-8x7b-32768" , channel: "MODEL-6" , system_prompt:system_prompt_6}
        ];
        var components = chatbotConfig.map(function(config) {
            return {
                url: "{{ url_athena }}",
                name: config.name,
                model: config.model,
                platform: config.platform,
                provider: config.provider,
                channel: config.channel,
                system_prompt: config.system_prompt
            };
        });

        component_1 = components[0]
        component_2 = components[1]
        component_3 = components[2]
        component_4 = components[3]
        component_5 = components[4]
        component_6 = components[5]

        var config = {
        content: [{
            type: 'column',
            content:[{  type: 'component',
                        componentName: 'user_prompt',
                        componentState: {},
                        height: '10'
                    },
                { type: 'row',
                 content:[ { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_1,
                            width: 33 },
                          { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_2,
                            width: 33} ,
                          { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_3,
                            width: 33 }]
            }, { type: 'row',
                 content:[
                      { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_4,
                            width: 33 },
                          { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_5,
                            width: 33} ,
                          { type: 'component',
                            componentName: 'chatbot',
                            componentState: component_6,
                            width: 33 }

                 ]}
            ]},

        ]
    };

    var myLayout = new GoldenLayout( config , "#layout");

    window.myLayout = myLayout
       myLayout.registerComponent('user_prompt', function(container, componentState) {
           html = `<webc-chat-input></webc-chat-input>`
           container.getElement().html(html)
       })

       myLayout.registerComponent('chatbot', function(container, componentState) {
           console.log(componentState.system_prompt)
           html = `<chatbot-openai name="${componentState.name}"
                                   channel="${componentState.channel}"
                                   platform="${componentState.platform}"
                                   provider="${componentState.provider}"
                                   model="${componentState.model}"
                                   show_sent_messages='false'
                                   edit_mode='false'
                                   system_prompt='${componentState.system_prompt}'>
                   </chatbot-openai>`

           container.getElement().html(html)
    });
    setTimeout(()=>{
        //myLayout.destroy();
        myLayout.init()
        let initial_prompt = 'What is OWASP?'
        send_message_to_llms(initial_prompt)
        hook_send_button()
    }, 1)

    function send_message_to_llm(channel, user_prompt) {
        events_utils.send_to_channel("new_input_message", channel, {'user_prompt': user_prompt})
    }
    function send_message_to_llms(message) {
        send_message_to_llm('MODEL-1',message )
        send_message_to_llm('MODEL-2',message )
        send_message_to_llm('MODEL-3',message )
        send_message_to_llm('MODEL-4',message )
        send_message_to_llm('MODEL-5',message )
        send_message_to_llm('MODEL-6',message )
    }
    function hook_send_button() {
        function on_click() {
            current_text = $('webc-chat-input')[0].input.value
            send_message_to_llms(current_text)
        }

        $('webc-chat-input')[0].send_user_message_event = on_click
        $('webc-chat-input')[0].on_action_button = on_click

        $('webc-chat-input')[0].input.value = 'What is OWASP?'
    }

});


</script>