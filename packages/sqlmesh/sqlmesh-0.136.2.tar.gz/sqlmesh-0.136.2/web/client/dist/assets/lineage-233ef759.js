(function(){"use strict";function p(n){return n===!1}function w(n){return a(n)||n===""}function a(n){return n==null}function D(...n){return n.filter(Boolean).join("__")}const r={Upstream:"upstream",Downstream:"downstream"},m=self;m.onmessage=async n=>{if(n.data.topic==="lineage")try{const{currentLineage:t,newLineage:s,mainNode:o}=n.data.payload,e=await y(t,s),c=await g(o,e);m.postMessage({topic:"lineage",payload:{lineage:e,nodesConnections:c}})}catch(t){m.postMessage({topic:"error",error:t})}};async function y(n={},t={}){return Object.entries(t).reduce((s,[o,e=[]])=>{var c;return o=encodeURI(o),s[o]={models:e.map(encodeURI),columns:((c=n==null?void 0:n[o])==null?void 0:c.columns)??void 0},s},{})}async function g(n,t={}){return new Promise((s,o)=>{if(a(t)||a(n))return{};const e={};try{d(r.Upstream,n,t,e),d(r.Downstream,n,t,e)}catch(c){o(c)}s(e)})}function d(n=r.Downstream,t,s={},o={}){var u;const e=n===r.Downstream;let c=[];e?c=Object.keys(s).filter(i=>s[i].models.includes(t)):c=((u=s[t])==null?void 0:u.models)??[],p(t in o)&&(o[t]=f());for(const i of c){const l=e?f(t,i,[o[t]]):f(i,t,[o[t]]);i in o?o[i].edges.push(l):(o[i]=l,d(n,i,s,o))}}function f(n,t,s=[]){const o=D(n,t);return{id:w(o)?void 0:o,edges:s}}})();
