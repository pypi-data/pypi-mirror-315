[tox]
envlist =
    lint
    py38
    py39
    py310
    py311
    py312
    py313
    docs
    coverage

[testenv]
deps =
    .[test,xml]
commands =
    zope-testrunner --test-path src --tests-pattern ^tests {posargs}

[testenv:lint]
basepython = python3.11
deps =
    pre-commit
skip_install = true
commands =
    pre-commit run -a

[testenv:docs]
basepython = python3.11
deps =
    .[docs]
commands =
    sphinx-build -b html -d src/lazr/restful/docs/_build/doctrees src/lazr/restful/docs src/lazr/restful/docs/_build/html

[testenv:coverage]
basepython = python3.11
deps =
    .[test,xml]
    coverage
commands =
    coverage erase
    coverage run -m zope.testrunner --test-path src --tests-pattern ^tests {posargs}
    coverage html
    coverage report -m --fail-under=92

[coverage:run]
source = lazr.restful
omit = */docs/conf.py

[flake8]
ignore =
    # incompatible with black
    E203
    W503

[isort]
known_first_party = lazr.uri
line_length = 79
profile = black
