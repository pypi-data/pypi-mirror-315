# SPDX-FileCopyrightText: b5327157 <b5327157@protonmail.com>
#
# SPDX-License-Identifier: GPL-3.0-or-later

sources:
- https://git.sr.ht/~b5327157/no_vtf-desktop

image: ubuntu/20.04
arch: amd64

secrets:
- a3cafe86-e4dd-4f18-b7ad-5809c8d577f2
- 076fcca6-4239-4488-bf29-ec6dd1e9852c

artifacts:
- no_vtf-desktop.tar.gz

tasks:
  - env: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh builds/debian/env.sh

  - python3_10: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh builds/python3.10-install.sh

  - lint: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh python3.10 builds/nox.py --session lint

  - package: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh python3.10 builds/nox.py --session package -- ~/no_vtf-desktop.tar.gz

  - verify_signatures: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh builds/verify_signatures.sh || complete-build

  - pre-release: |
      cd no_vtf-desktop
      [ "$(git rev-parse --verify HEAD)" == "$(git rev-parse --verify master)" ] || complete-build
      git describe --exact-match 2>/dev/null || complete-build

  - publish_package: |
      cd no_vtf-desktop
      builds/pprint_xtrace.sh builds/sr_ht.sh python3.10 builds/nox.py --session publish -- ~/.pypi.org.token
